<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Performance Optimizer</title>
    <style>
        /* å†…è”å…³é”®CSSä»¥é¿å…é¢å¤–çš„HTTPè¯·æ±‚ */
        .performance-optimizer {
            position: fixed;
            top: 10px;
            right: 10px;
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 8px;
            font-size: 12px;
            z-index: 1000;
            display: none;
        }
        
        .performance-optimizer.show {
            display: block;
        }
        
        .optimizer-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 3px;
            cursor: pointer;
            margin: 2px;
        }
        
        .optimizer-button:hover {
            background: #0056b3;
        }
    </style>
</head>
<body>
    <!-- æ€§èƒ½ä¼˜åŒ–æ§åˆ¶é¢æ¿ -->
    <div id="performance-optimizer" class="performance-optimizer">
        <div>ğŸš€ Performance Optimizer</div>
        <button class="optimizer-button" onclick="enableLazyLoading()">Enable Lazy Loading</button>
        <button class="optimizer-button" onclick="enableVirtualScroll()">Enable Virtual Scroll</button>
        <button class="optimizer-button" onclick="optimizeForSafari()">Optimize for Safari</button>
        <button class="optimizer-button" onclick="hideOptimizer()">Hide</button>
    </div>

    <script>
        // æ€§èƒ½ä¼˜åŒ–å™¨
        function showOptimizer() {
            const optimizer = document.getElementById('performance-optimizer');
            if (optimizer) {
                optimizer.classList.add('show');
            }
        }
        
        function hideOptimizer() {
            const optimizer = document.getElementById('performance-optimizer');
            if (optimizer) {
                optimizer.classList.remove('show');
            }
        }
        
        function enableLazyLoading() {
            // å¯ç”¨æ‡’åŠ è½½
            const checkboxes = document.querySelectorAll('.tool-details-checkbox');
            checkboxes.forEach(function(checkbox) {
                if (!checkbox.dataset.lazyEnabled) {
                    checkbox.dataset.lazyEnabled = 'true';
                    // è¿™é‡Œä¼šè§¦å‘æ‡’åŠ è½½é€»è¾‘
                }
            });
            console.log('Lazy loading enabled');
        }
        
        function enableVirtualScroll() {
            // å¯ç”¨è™šæ‹Ÿæ»šåŠ¨
            if (window.VirtualScroll) {
                window.VirtualScroll.refresh();
                console.log('Virtual scroll enabled');
            }
        }
        
        function optimizeForSafari() {
            // Safariç‰¹å®šä¼˜åŒ–
            if (navigator.userAgent.includes('Safari') && !navigator.userAgent.includes('Chrome')) {
                // å‡å°‘é‡ç»˜å’Œé‡æ’
                const toolResults = document.querySelectorAll('.result-box, .error-box, .overlong-box');
                toolResults.forEach(function(result) {
                    result.style.contain = 'layout style paint';
                    result.style.willChange = 'transform';
                });
                
                // ä½¿ç”¨transformä»£æ›¿æ”¹å˜ä½ç½®å±æ€§
                const toolDetails = document.querySelectorAll('.tool-details');
                toolDetails.forEach(function(detail) {
                    detail.style.transform = 'translateZ(0)';
                });
                
                console.log('Safari optimizations applied');
            }
        }
        
        // æ£€æµ‹æ€§èƒ½é—®é¢˜å¹¶æ˜¾ç¤ºä¼˜åŒ–å™¨
        function detectPerformanceIssues() {
            const toolResults = document.querySelectorAll('.result-box, .error-box, .overlong-box');
            const toolDetails = document.querySelectorAll('.tool-details');
            
            // å¦‚æœå·¥å…·ç»“æœå¾ˆå¤šï¼Œæ˜¾ç¤ºä¼˜åŒ–å™¨
            if (toolResults.length > 10 || toolDetails.length > 20) {
                showOptimizer();
            }
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåæ£€æµ‹æ€§èƒ½é—®é¢˜
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(detectPerformanceIssues, 1000);
        });
        
        // ç›‘å¬å·¥å…·è¯¦æƒ…å±•å¼€äº‹ä»¶
        document.addEventListener('change', function(e) {
            if (e.target.classList.contains('tool-details-checkbox')) {
                // å·¥å…·è¯¦æƒ…è¢«å±•å¼€ï¼Œå¯ä»¥åœ¨è¿™é‡Œæ·»åŠ æ€§èƒ½ç›‘æ§
                console.log('Tool details expanded:', e.target.id);
            }
        });
    </script>
</body>
</html>
